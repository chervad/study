Ember.TEMPLATES["javascripts/connectors/user-preferences-interface/show-quick-messages"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"div"],[11,"class","controls"],[9],[0,"\\n  "],[7,"label"],[11,"class","checkbox-label"],[9],[0,"\\n    "],[1,[27,"input",null,[["type","checked"],["checkbox",[23,["model","custom_fields","show_quick_messages"]]]]],false],[0,"\\n    "],[1,[27,"i18n",["user_preferences.quick_messages_preference"],null],false],[0,"\\n  "],[10],[0,"\\n"],[10]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/user-preferences-interface/show-quick-messages"}}),Ember.TEMPLATES["javascripts/components/docked-post"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[23,["isSmallAction"]]],null,{"statements":[[0,"  "],[1,[27,"mount-widget",null,[["widget","args"],["docked-small-action",[23,["post"]]]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"  "],[7,"div"],[11,"class","docked-post-user"],[12,"data-user-card",[28,[[23,["post","username"]]]]],[9],[0,"\\n"],[4,"unless",[[23,["post","yours"]]],null,{"statements":[[0,"      "],[7,"div"],[12,"class",[28,[[21,"avatarClasses"]]]],[9],[0,"\\n        "],[1,[27,"avatar",[[23,["post"]]],[["avatarTemplatePath","usernamePath","imageSize"],["avatar_template","username","small"]]],false],[0,"\\n      "],[10],[0,"\\n"]],"parameters":[]},null],[0,"  "],[10],[0,"\\n  "],[7,"div"],[12,"class",[28,["docked-post-content ",[21,"contentClass"]]]],[9],[0,"\\n    "],[1,[27,"docked-post-content",null,[["post"],[[23,["post"]]]]],false],[0,"\\n  "],[10],[0,"\\n"]],"parameters":[]}]],"hasEval":false}',meta:{moduleName:"javascripts/components/docked-post"}}),Ember.TEMPLATES["javascripts/components/docked-composer"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["post"],"statements":[[7,"div"],[11,"class","docked-composer-header"],[9],[0,"\\n  "],[7,"div"],[11,"class","controls"],[9],[0,"\\n    "],[7,"a"],[11,"href",""],[11,"class","cancel"],[11,"tabindex","6"],[9],[0,"\\n      "],[1,[27,"d-icon",["times"],null],false],[0,"\\n    "],[3,"action",[[22,0,[]],"cancel"]],[10],[0,"\\n    "],[7,"a"],[11,"href",""],[11,"class","toggler"],[12,"title",[27,"i18n",["composer.toggler"],null]],[9],[0,"\\n      "],[1,[27,"d-icon",[[23,["togglerIcon"]]],null],false],[0,"\\n    "],[3,"action",[[22,0,[]],"toggle"],[["bubbles"],[false]]],[10],[0,"\\n    "],[7,"a"],[11,"href",""],[11,"class","topic-link"],[12,"title",[27,"i18n",["composer.open_message_topic"],null]],[9],[0,"\\n      "],[1,[27,"d-icon",["external-link"],null],false],[0,"\\n    "],[3,"action",[[22,0,[]],"openTopic"]],[10],[0,"\\n  "],[10],[0,"\\n"],[4,"if",[[23,["firstPost"]]],null,{"statements":[[0,"    "],[1,[27,"user-selector",null,[["topicId","excludeCurrentUser","id","includeMentionableGroups","placeholderKey","tabindex","usernames"],[[23,["topic","id"]],"true","private-message-users","true","composer.users_placeholder","1",[23,["targetUsernames"]]]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"    "],[7,"div"],[11,"class","docked-usernames-wrapper"],[9],[0,"\\n"],[4,"if",[[23,["hiddenUsernames"]]],null,{"statements":[[0,"        "],[7,"a"],[11,"class","docked-usernames"],[9],[0,"\\n          "],[1,[21,"otherUsernames"],false],[0,"\\n        "],[3,"action",[[22,0,[]],"showUsernames"]],[10],[0,"\\n"]],"parameters":[]},{"statements":[[0,"        "],[7,"span"],[11,"class","docked-usernames"],[9],[1,[21,"otherUsernames"],false],[10],[0,"\\n"]],"parameters":[]}],[0,"    "],[10],[0,"\\n"],[4,"if",[[23,["showUsernames"]]],null,{"statements":[[0,"      "],[7,"div"],[11,"class","extra-usernames"],[9],[0,"\\n        "],[1,[21,"otherUsernames"],false],[0,"\\n        "],[7,"a"],[11,"href",""],[11,"class","cancel"],[9],[0,"\\n          "],[1,[27,"d-icon",["times"],null],false],[0,"\\n        "],[3,"action",[[22,0,[]],"showUsernames"]],[10],[0,"\\n      "],[10],[0,"\\n"]],"parameters":[]},null]],"parameters":[]}],[10],[0,"\\n"],[4,"if",[[23,["composerOpen"]]],null,{"statements":[[0,"  "],[7,"div"],[11,"class","docked-composer-posts"],[9],[0,"\\n"],[4,"if",[[23,["disableEditor"]]],null,{"statements":[[0,"      "],[7,"div"],[11,"class","docked-composer-tip"],[9],[0,"\\n        "],[7,"span"],[9],[1,[27,"i18n",["composer.quick_duplicate"],null],false],[10],[0,"\\n      "],[10],[0,"\\n"]],"parameters":[]},{"statements":[[4,"if",[[23,["loading"]]],null,{"statements":[[0,"        "],[1,[27,"loading-spinner",null,[["size"],[[23,["spinnerSize"]]]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"        "],[7,"div"],[11,"class","docked-post-stream"],[9],[0,"\\n"],[4,"each",[[23,["postStream","posts"]]],null,{"statements":[[0,"            "],[1,[27,"docked-post",null,[["post"],[[22,1,[]]]]],false],[0,"\\n"]],"parameters":[1]},null],[0,"        "],[10],[0,"\\n"]],"parameters":[]}]],"parameters":[]}],[0,"  "],[10],[0,"\\n\\n  "],[1,[27,"docked-editor",null,[["tabindex","value","composer","placeholder","disabled","toggleEmojiPicker","emojiPickerOpen","scrollPoststream"],[[23,["editorTabIndex"]],[23,["reply"]],[22,0,[]],"composer.quick_placeholder",[23,["disableEditor"]],"toggleEmojiPicker",[23,["emojiPickerOpen"]],"scrollPoststream"]]],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/docked-composer"}}),Ember.TEMPLATES["javascripts/components/docked-editor"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"div"],[11,"class","docked-editor-container"],[9],[0,"\\n  "],[7,"div"],[11,"class","button-bar"],[9],[0,"\\n    "],[1,[27,"d-button",null,[["action","class","icon","mouseDown"],["openEmojiPicker","btn qm-emoji","smile-o",[27,"action",[[22,0,[]],"buttonMousedown"],null]]]],false],[0,"\\n    "],[1,[27,"docked-upload",null,[["uploadDone","mouseDown"],[[27,"action",[[22,0,[]],"uploadDone"],null],[27,"action",[[22,0,[]],"buttonMousedown"],null]]]],false],[0,"\\n  "],[10],[0,"\\n  "],[7,"div"],[11,"class","docked-editor-textarea-wrapper"],[9],[0,"\\n    "],[1,[27,"docked-expanding-textarea",null,[["tabindex","value","class","placeholder","disabled","scrollPoststream","focusChange"],[null,[23,["value"]],"d-editor-input",[23,["placeholderTranslated"]],[23,["disabled"]],"scrollPoststream","focusChange"]]],false],[0,"\\n    "],[1,[27,"popup-input-tip",null,[["validation"],[[23,["validation"]]]]],false],[0,"\\n  "],[10],[0,"\\n\\n  "],[1,[27,"emoji-picker",null,[["active","automaticPositioning","emojiSelected"],[[23,["emojiPickerOpen"]],false,[27,"action",[[22,0,[]],"emojiSelected"],null]]]],false],[0,"\\n"],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/components/docked-editor"}}),Ember.TEMPLATES["javascripts/components/docked-upload"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[23,["uploading"]]],null,{"statements":[[0,"  "],[7,"div"],[11,"class","docked-uploading"],[9],[0,"\\n    "],[1,[21,"uploadProgress"],false],[0,"%\\n  "],[10],[0,"\\n"]],"parameters":[]},{"statements":[[0,"  "],[7,"label"],[11,"class","btn btn-small"],[12,"disabled",[21,"uploading"]],[9],[0,"\\n    "],[1,[27,"d-icon",["picture-o"],[["class"],["qm-upload-picture"]]],false],[0,"\\n    "],[7,"input"],[12,"disabled",[21,"uploading"]],[11,"style","visibility: hidden; position: absolute;"],[11,"multiple",""],[11,"type","file"],[9],[10],[0,"\\n  "],[10],[0,"\\n"]],"parameters":[]}]],"hasEval":false}',meta:{moduleName:"javascripts/components/docked-upload"}}),define("discourse/plugins/discourse-quick-messages/discourse/connectors/user-preferences-interface/show-quick-messages",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,t){return Discourse.SiteSettings.quick_message_enabled&&Discourse.SiteSettings.quick_message_user_preference&&e.model.quick_messages_access}}}),Ember.TEMPLATES["javascripts/discourse/connectors/above-footer/messages-container"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["id","index"],"statements":[[4,"each",[[23,["docked"]]],null,{"statements":[[0,"  "],[1,[27,"docked-composer",null,[["id","docked","maxIndex","index","removeDocked","updateId"],[[22,1,[]],[23,["docked"]],[23,["maxIndex"]],[22,2,[]],"removeDocked","updateId"]]],false],[0,"\\n"]],"parameters":[1,2]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/connectors/above-footer/messages-container"}}),define("discourse/plugins/discourse-quick-messages/discourse/connectors/above-footer/messages-container",["exports","discourse-common/lib/get-owner"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={setupComponent:function(e,s){var i=(0,t.getOwner)(this).lookup("controller:application"),n=i.get("docked"),r=i.get("maxIndex");s.setProperties({docked:n,maxIndex:r})},actions:{removeDocked:function(e){(0,t.getOwner)(this).lookup("controller:application").send("removeDocked",e)},updateId:function(e,s){(0,t.getOwner)(this).lookup("controller:application").send("updateId",e,s)}}}}),define("discourse/plugins/discourse-quick-messages/discourse/initializers/quick-messages-initializer",["exports","ember-addons/ember-computed-decorators","discourse/lib/plugin-api","discourse/lib/url","discourse-common/lib/get-owner"],function(e,t,s,i,n){"use strict";function r(e,t,s,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=s.slice().reverse().reduce(function(s,i){return i(e,t,s)||s},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"quick-messages-initializer",initialize:function(e){var o=e.lookup("site-settings:main"),a=e.lookup("current-user:main"),c=e.lookup("site:main");(0,s.withPluginApi)("0.8.12",function(e){if(a&&a.show_quick_messages&&(e.reopenWidget("header-notifications",{html:function(e){return this._super(e).filter(function(e){return!(e.properties||e.attrs).className.match(/(messages|ring)/)})}}),e.decorateWidget("header-icons:before",function(e){var t=e.widget.parentWidget.state,s=[];if(a&&(!c.mobileView||o.quick_message_mobile)){var i=a.get("unread_private_messages");s.push(e.attach("header-dropdown",{title:"user.private_messages",icon:o.quick_message_icon,iconId:"toggle-messages-menu",active:t.messagesVisible,action:"toggleMessages",contents:function(){if(i)return this.attach("link",{action:"toggleMessages",className:"badge-notification unread-private-messages",rawLabel:""+i})}}))}return s}),e.addHeaderPanel("messages-menu","messagesVisible",function(e,t){return{}}),e.attachWidgetAction("header","toggleMessages",function(){this.state.messagesVisible=!this.state.messagesVisible}),e.attachWidgetAction("header","addToDocked",function(e){this.messagesClicked(),(0,n.getOwner)(this).lookup("controller:application").send("addToDocked",e)}),e.attachWidgetAction("header","messagesClicked",function(){this.linkClickedEvent(),this.state.messagesVisible=!1}),e.attachWidgetAction("header","goToMessages",function(){this.messagesClicked(),i.default.routeTo("/users/"+this.currentUser.get("username")+"/messages")}),Discourse.SiteSettings.whos_online_enabled&&e.modifyClass("component:docked-post",{onlineService:Ember.inject.service("online-service")})),Discourse.SiteSettings.quick_message_enabled){var s,l,u;e.modifyClass("controller:preferences/interface",(s=(0,t.default)("makeThemeDefault"),l=(0,t.observes)("saved"),u={saveAttrNames:function(){var e=this._super.apply(this,arguments);return e.includes("custom_fields")||e.push("custom_fields"),e},_updateShowQuickMessages:function(){this.get("saved")&&a&&this.get("model.id")===a.get("id")&&a.set("quick_messages_pref",this.get("model.custom_fields.quick_messages_pref"))}},r(u,"saveAttrNames",[s],Object.getOwnPropertyDescriptor(u,"saveAttrNames"),u),r(u,"_updateShowQuickMessages",[l],Object.getOwnPropertyDescriptor(u,"_updateShowQuickMessages"),u),u))}})}}}),define("discourse/plugins/discourse-quick-messages/discourse/components/docked-expanding-textarea",["exports","ember-addons/ember-computed-decorators","discourse/components/expanding-text-area"],function(e,t,s){"use strict";function i(e,t,s,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=s.slice().reverse().reduce(function(s,i){return i(e,t,s)||s},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0});var n,r,o,a;e.default=s.default.extend((n=(0,t.on)("didInsertElement"),r=(0,t.on)("willDestroyElement"),o=(0,t.observes)("value"),a={attributeBindings:["disabled","rows"],rows:1,setupListners:function(){var e=this,t=function(){return e.sendAction("focusChange","focus")},s=function(){return e.sendAction("focusChange","blur")};this.setProperties({focus:t,blur:s}),Ember.run.scheduleOnce("afterRender",function(){e.$().one("click",Ember.run.bind(e,t)),e.$().on("focus",Ember.run.bind(e,t)),e.$().on("blur",Ember.run.bind(e,s)),$(document).on("visibilitychange",Ember.run.bind(e,s))})},destroyListners:function(){this.$().off("focus",Ember.run.bind(this,this.get("focus"))),this.$().off("blur",Ember.run.bind(this,this.get("blur"))),$(document).off("visibilitychange",Ember.run.bind(this,this.get("blur")))},_updateAutosize:function(){var e=this;Ember.run.scheduleOnce("afterRender",function(){var t=document.createEvent("Event");t.initEvent("autosize:update",!0,!1),e.element.dispatchEvent(t)})}},i(a,"setupListners",[n],Object.getOwnPropertyDescriptor(a,"setupListners"),a),i(a,"destroyListners",[r],Object.getOwnPropertyDescriptor(a,"destroyListners"),a),i(a,"_updateAutosize",[o],Object.getOwnPropertyDescriptor(a,"_updateAutosize"),a),a))}),define("discourse/plugins/discourse-quick-messages/discourse/components/docked-upload",["exports","discourse/mixins/upload"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=Ember.Component.extend(t.default,{classNames:"docked-upload"})}),define("discourse/plugins/discourse-quick-messages/discourse/components/docked-editor",["exports","discourse/components/d-editor","discourse/lib/user-search","discourse/lib/raw-templates","ember-addons/ember-computed-decorators","discourse/lib/utilities","../lib/docked-composer"],function(e,t,s,i,n,r,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a,c;e.default=t.default.extend((a=(0,n.on)("didInsertElement"),c={classNames:["docked-editor"],dockedUpload:!1,setupDocked:function(){var e=this.$(".d-editor-input");this._applyMentionAutocomplete(e)},_applyMentionAutocomplete:function(e){var t=this.get("topic.id");e.autocomplete({template:(0,i.findRawTemplate)("user-selector-autocomplete"),dataSource:function(e){return(0,s.default)({term:e,topicId:t,includeGroups:!0})},key:"@",transformComplete:function(e){return e.username||e.name}})},handleIOSPositioning:function(e){if((0,r.isAppleDevice)()){var t=$(".docked-composer"),s={};if("blur"===e)s.height="100%";else{var i=$("body,html"),n=(0,o.calcHeightWithKeyboard)();s.height=n,i.scrollTop(0)}t.css(s),this.sendAction("scrollPoststream")}},actions:{uploadDone:function(e){var t="!["+e.original_filename+"]("+e.url+")";this._addText(this._getSelected(),t),Ember.run.scheduleOnce("afterRender",function(){return $(".d-editor-input").blur()})},openEmojiPicker:function(){this.sendAction("toggleEmojiPicker")},emojiSelected:function(e){this._super(e),this.sendAction("toggleEmojiPicker"),Ember.run.scheduleOnce("afterRender",function(){return $(".d-editor-input").click()})},focusChange:function(e){var t=this;this.handleIOSPositioning(e),"focus"===e&&this.sendAction("toggleEmojiPicker",!1),Ember.run.scheduleOnce("afterRender",function(){"destroying"!==t._state&&t.set("focusState",e)})},buttonMousedown:function(e){var t=this;this.site.mobileView&&"focus"===this.get("focusState")&&Ember.run.next(function(){var s=$(e.target);s.hasClass("qm-upload-picture")&&t.$(".docked-upload input").click(),s.hasClass("qm-emoji")&&t.sendAction("toggleEmojiPicker")})}}},function(e,t,s,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=s.slice().reverse().reduce(function(s,i){return i(e,t,s)||s},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}(c,"setupDocked",[a],Object.getOwnPropertyDescriptor(c,"setupDocked"),c),c))}),define("discourse/plugins/discourse-quick-messages/discourse/components/docked-post-content",["exports","ember-addons/ember-computed-decorators","discourse/components/mount-widget"],function(e,t,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,n;e.default=s.default.extend((i=(0,t.observes)("post.cooked"),n={widget:"docked-post",_rerender:function(){this.queueRerender()},buildArgs:function(){return{post:this.get("post")}}},function(e,t,s,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=s.slice().reverse().reduce(function(s,i){return i(e,t,s)||s},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}(n,"_rerender",[i],Object.getOwnPropertyDescriptor(n,"_rerender"),n),n))}),define("discourse/plugins/discourse-quick-messages/discourse/components/docked-composer",["exports","ember-addons/ember-computed-decorators","discourse/components/site-header","../lib/user-messages","discourse/lib/text","../lib/docked-screen-track","discourse-common/lib/get-owner","discourse/lib/url","../lib/docked-composer","discourse/lib/ajax-error"],function(e,t,s,i,n,r,o,a,c,l){"use strict";function u(e,t,s,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=s.slice().reverse().reduce(function(s,i){return i(e,t,s)||s},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}function d(e){return e.clientY||e.touches&&e.touches[0]&&e.touches[0].clientY}Object.defineProperty(e,"__esModule",{value:!0});var p,m,g,f,h,b,v,w,y,k,E,O,P,x,j,S,T,C,M={raw:"reply",title:"title",topic_id:"topic.id",archetype:"archetypeId",target_usernames:"targetUsernames"};e.default=Ember.Component.extend((p=(0,t.on)("didInsertElement"),m=(0,t.on)("didInsertElement"),g=(0,t.observes)("index"),f=(0,t.observes)("composeState"),h=(0,t.observes)("composerOpen"),b=(0,t.default)("targetUsernames","missingReplyCharacters"),v=(0,t.default)("reply"),w=(0,t.default)("index"),y=(0,t.default)(),k=(0,t.observes)("emojiPickerOpen"),E=(0,t.default)("composeState"),O=(0,t.on)("init"),P=(0,t.observes)("topic.postStream.loadedAllPosts"),x=(0,t.default)("topic.details.loaded"),j=(0,t.on)("didInsertElement"),S=(0,t.observes)("otherUsernames"),T=(0,t.observes)("targetUsernames"),C={tagName:"div",classNameBindings:[":docked-composer","composeState"],disableSubmit:Ember.computed.or("loading","uploading"),composerOpen:Ember.computed.equal("composeState","open"),postStream:Ember.computed.alias("topic.postStream"),loading:!0,composeState:null,targetUsernames:null,firstPost:!1,archetypeId:"private_message",reply:"",topic:null,emojiPickerOpen:!1,hiddenUsernames:!1,mobileKeyboard:!1,_setupDisplay:function(){this.set("composeState","open"),this.site.mobileView||this.setupComposerResizeEvents()},setupComposerResizeEvents:function(){var e=this,t=this.$(),i=this.$(".docked-composer-header"),n=Ember.$(document),r=0,o=0,a=function(i){t.trigger("div-resizing"),t.addClass("clear-transitions");var n=d(i),a=r+(o-n),c=Ember.$(window).height();a=Math.min(a,c-(0,s.headerHeight)()),a=Math.max(a,240);var l=a+"px";e.movePanels(l),t.height(l)},c=function(t){t.preventDefault(),Ember.run.throttle(e,a,t,20)}.bind(this),l=function e(){n.off("touchmove mousemove",c),n.off("touchend mouseup",e),t.removeClass("clear-transitions"),t.focus()};i.on("touchstart mousedown",function(e){e.preventDefault(),r=t.height(),o=d(e),n.on("touchmove mousemove",c),n.on("touchend mouseup",l)})},_arrangeComposers:function(){var e=this;this.site.mobileView||Ember.run.scheduleOnce("afterRender",function(){var t=e.get("index"),s=340*t+100;e.$().css("right",s)})},_resize:function(){var e=this.$()?this.$().height():0;this.movePanels(e+"px")},stopBodyScrollingOnMobile:function(){if(this.site.mobileView){var e=this.get("composerOpen"),t=$("body, html");e?(t.scrollTop(0),t.addClass("noscroll")):t.removeClass("noscroll")}},movePanels:function(e){$("#main-outlet").css("padding-bottom",e)},cantSubmitPost:function(){return this.get("replyLength")<1||this.get("targetUsernames")&&0===(this.get("targetUsernames").trim()+",").indexOf(",")},replyLength:function(){return(this.get("reply")||"").replace(/\s+/gim," ").trim().length},editorTabIndex:function(e){return this.site.mobileView?null:e+1},spinnerSize:function(){return this.site.mobileView?"large":"small"},setupEmojiPickerCss:function(){var e=this;this.get("emojiPickerOpen")?(this.$().css("z-index",100),Ember.run.next(function(){var t={visibility:"visible"};if(e.site.mobileView){var s=e.$().find(".docked-editor").height();t.left=5,t.right=5,t.bottom=s+5}else{var i=e.$().offset(),n=i.left;t.bottom=20,n>400?t.left=n-400:$(window).width()-(n-300)>400?t.left=n+300:(t.left=n,t.bottom=e.$().height())}$(".emoji-picker").css(t)})):($(".emoji-picker").css("visibility","hidden"),this.$().css("z-index",0))},click:function(){"minimized"===this.get("composeState")&&this.open()},closeAutocomplete:function(){this.$(".d-editor-input").autocomplete({cancel:!0})},keyDown:function(e){var t=13===e.which,s=e.shiftKey;if(27===e.which)return this.toggle(),!1;if(t&&s){var i=this.get("reply");return i+="\n",this.set("reply",i),!1}return t?(this.save(),!1):void 0},open:function(){var e=this,t=this.site.mobileView?$(window).height():400;this.set("composeState","open"),this.$()&&(Ember.run.scheduleOnce("afterRender",function(){e.$(".d-editor-input").one("focus",function(){e.$(".d-editor-input").blur()})}),this.$().animate({height:t},200,function(){e.afterStreamRender()}))},collapse:function(){var e=this.site.mobileView?50:40;this.set("composeState","minimized"),this.$()&&this.$().animate({height:e},200)},close:function(){var e=this;this.set("composeState","closed"),this.$()&&this.$().animate({height:0},200,function(){e.sendAction("removeDocked",e.get("index"))})},cancel:function(){var e=this;return new Ember.RSVP.Promise(function(t){e.get("reply")?bootbox.confirm(I18n.t("post.abandon.confirm"),I18n.t("post.abandon.no_value"),I18n.t("post.abandon.yes_value"),function(s){s&&(e.close(),t())}):(e.close(),t())})},toggle:function(){switch(this.closeAutocomplete(),this.get("composeState")){case"open":this.collapse();break;case"minimized":this.open()}return!1},togglerIcon:function(e){return"minimized"===e?"angle-up":"angle-down"},scrollPoststream:function(){var e=this.$(".docked-composer-posts"),t=this.$(".docked-post-stream"),s=t.height(),i=this;this.$(".docked-post-stream img:not(.avatar)").each(function(){0===$(this).height()&&$(this).on("load",function(){this.complete&&i.scrollPoststream()})}),e.scrollTop(s)},actions:{save:function(){this.save()},cancel:function(){this.cancel()},toggle:function(){this.toggle()},openTopic:function(){var e=this.get("topic.url");this.cancel(),a.default.routeTo(e)},showUsernames:function(){this.toggleProperty("showUsernames")},toggleEmojiPicker:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!==e?this.set("emojiPickerOpen",e):this.toggleProperty("emojiPickerOpen")},scrollPoststream:function(){this.scrollPoststream()}},setTopic:function(){var e=this,t=this.get("id");if("new"===t)return this.setProperties({firstPost:!0,loading:!1}),!1;this.set("topic",this.getTopic(t)),this.subscribeToTopic(),this.site.mobileView||this.appEvents.on("composer:opened",function(){return e.collapse()})},getTopic:function(e){return(0,o.getOwner)(this).lookup("store:main").createRecord("topic",{id:e})},subscribeToTopic:function(){var e=this,t=this.get("topic");if(t){var s=t.get("postStream"),i={topic_id:t.id,highest_post_number:t.highest_post_number,last_read_post_number:Math.min(t.highest_post_number,t.last_read_post_number),created_at:t.created_at,category_id:t.category_id,notification_level:t.notification_level};(0,o.getOwner)(this).lookup("topic-tracking-state:main").loadStates([i]),this.messageBus.subscribe("/topic/"+t.id,function(t){"created"===t.type&&(s.triggerNewPostInStream(t.id).then(function(){return e.afterStreamRender()}),e.get("currentUser.id")!==t.user_id&&Discourse.notifyBackgroundCountIncrement())})}},afterStreamRender:function(){var e=this,t=this.get("postStream");if(t){var s=this.get("topic.highest_post_number");t.refresh({nearPost:s}).then(function(){"destroying"!==e._state&&(e.set("loading",!1),Ember.run.scheduleOnce("afterRender",function(){e.$()&&(e.scrollPoststream(),(0,r.dockedScreenTrack)(e,e.get("topic")))}))})}},otherUsernames:function(e){if(e){var t=(0,c.getUsernames)(this.get("topic.details.allowed_users"));return t.splice(t.indexOf(this.get("currentUser.username")),1),(0,c.formatUsernames)(t)}return""},handleLongUsernames:function(){var e=this;this.get("otherUsernames")&&Ember.run.scheduleOnce("afterRender",this,function(){e.$(".docked-usernames").width()>e.$(".docked-usernames-wrapper").width()&&e.set("hiddenUsernames",!0)})},createOrContinue:function(){var e=this,t=this.get("currentUser.username"),s=null,n=this.get("targetUsernames").split(",");n.push(t),(0,i.getCurrentUserMessages)(this).then(function(i){if(i.forEach(function(e){var i=(0,c.getUsernames)(e.participants);-1===i.indexOf(t)&&i.push(t),_.isEqual(_.sortBy(i),_.sortBy(n))&&(s=e.id)}),s){e.get("docked").indexOf(s)>-1?e.set("disableEditor",!0):(e.setProperties({topic:e.getTopic(s),disableEditor:!1}),e.subscribeToTopic())}else e.setProperties({id:"new",topic:null,title:(0,c.formatUsernames)(n),disableEditor:!1})})},save:function(){if(!this.get("cantSubmitPost")){var e=(0,o.getOwner)(this).lookup("store:main"),t=this.get("postStream"),s=this.get("currentUser"),i=e.createRecord("post",{cooked:(0,n.emojiUnescape)(this.get("reply")),yours:!0}),r={custom_fields:{quick_message:!0}};this.serialize(M,r),this.set("reply","");var a="";t&&(a=t.stagePost(i,s),this.set("firstPost",!1)),"staged"===a&&this.afterStreamRender();var c=this,u=this.get("id");i.save(r).then(function(e){t&&(s.set("reply_count",s.get("reply_count")+1),t.commitPost(i)),u&&"new"!==u||(c.set("firstPost",!1),c.sendAction("updateId",c.get("index"),e.responseJson.post.topic_id),"new"===u&&s.set("topic_count",s.get("topic_count")+1))}).catch(l.popupAjaxError)}},serialize:function(e,t){var s=this;return t=t||{},Object.keys(e).forEach(function(i){var n=s.get(e[i]);void 0!==n&&Ember.set(t,i,n)}),t}},u(C,"_setupDisplay",[p],Object.getOwnPropertyDescriptor(C,"_setupDisplay"),C),u(C,"_arrangeComposers",[m,g],Object.getOwnPropertyDescriptor(C,"_arrangeComposers"),C),u(C,"_resize",[f],Object.getOwnPropertyDescriptor(C,"_resize"),C),u(C,"stopBodyScrollingOnMobile",[h],Object.getOwnPropertyDescriptor(C,"stopBodyScrollingOnMobile"),C),u(C,"cantSubmitPost",[b],Object.getOwnPropertyDescriptor(C,"cantSubmitPost"),C),u(C,"replyLength",[v],Object.getOwnPropertyDescriptor(C,"replyLength"),C),u(C,"editorTabIndex",[w],Object.getOwnPropertyDescriptor(C,"editorTabIndex"),C),u(C,"spinnerSize",[y],Object.getOwnPropertyDescriptor(C,"spinnerSize"),C),u(C,"setupEmojiPickerCss",[k],Object.getOwnPropertyDescriptor(C,"setupEmojiPickerCss"),C),u(C,"togglerIcon",[E],Object.getOwnPropertyDescriptor(C,"togglerIcon"),C),u(C,"setTopic",[O],Object.getOwnPropertyDescriptor(C,"setTopic"),C),u(C,"afterStreamRender",[P],Object.getOwnPropertyDescriptor(C,"afterStreamRender"),C),u(C,"otherUsernames",[x],Object.getOwnPropertyDescriptor(C,"otherUsernames"),C),u(C,"handleLongUsernames",[j,S],Object.getOwnPropertyDescriptor(C,"handleLongUsernames"),C),u(C,"createOrContinue",[T],Object.getOwnPropertyDescriptor(C,"createOrContinue"),C),C))}),define("discourse/plugins/discourse-quick-messages/discourse/components/docked-post",["exports","ember-addons/ember-computed-decorators"],function(e,t){"use strict";function s(e,t,s,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=s.slice().reverse().reduce(function(s,i){return i(e,t,s)||s},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0});var i,n,r,o;e.default=Ember.Component.extend((i=(0,t.default)("post.yours"),n=(0,t.default)("onlineService.users.@each","post.user_id"),r=(0,t.default)("post.post_type"),o={tagName:"div",classNames:"docked-post",contentClass:function(e){return e?"yours":""},avatarClasses:function(e,t){var s="docked-avatar",i=this.get("onlineService");return i&&i.isUserOnline(t)&&(s+=" user-online"),s},isSmallAction:function(e){return e===this.site.post_types.small_action}},s(o,"contentClass",[i],Object.getOwnPropertyDescriptor(o,"contentClass"),o),s(o,"avatarClasses",[n],Object.getOwnPropertyDescriptor(o,"avatarClasses"),o),s(o,"isSmallAction",[r],Object.getOwnPropertyDescriptor(o,"isSmallAction"),o),o))}),define("discourse/plugins/discourse-quick-messages/discourse/lib/docked-screen-track",["exports","discourse/lib/ajax","discourse-common/lib/get-owner"],function(e,t,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.dockedScreenTrack=void 0;var i=function(e,i){if(i){var n=i.highest_post_number,r=Math.min(n,i.last_read_post_number);(0,s.getOwner)(e).lookup("topic-tracking-state:main").updateSeen(i.id,n);var o={};if(r===n)o[n]=3e3;else for(var a=r+1;a<=n;a++)o[a]=3e3;(0,t.ajax)("/topics/timings",{data:{timings:o,topic_time:3e3,topic_id:i.id},cache:!1,type:"POST",headers:{"X-SILENCE-LOGGER":"true"}})}};e.dockedScreenTrack=i}),define("discourse/plugins/discourse-quick-messages/discourse/lib/user-messages",["exports","discourse-common/lib/get-owner"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getCurrentUserMessageCount=e.getCurrentUserMessages=void 0;var s=function(e){var s=(0,t.getOwner)(e).lookup("store:main"),i=e.currentUser.get("username");return s.findFiltered("topicList",{filter:"topics/private-messages/"+i}).then(function(e){var t=e.topics,n=e.topics.map(function(e){return e.id});return s.findFiltered("topicList",{filter:"topics/private-messages-sent/"+i}).then(function(e){var s=e.topics.filter(function(e){return-1===n.indexOf(e.id)}),i=t.concat(s);return i.sort(function(e,t){return e=new Date(e.last_posted_at),t=new Date(t.last_posted_at),e>t?-1:e<t?1:0}),i=i.filter(function(e){return"user_to_user"===e.subtype})}).catch(function(){return console.log("getting sent messages failed"),[]})}).catch(function(){return console.log("getting inbox failed"),[]})},i=function(e,t){var s=e.container.lookup("store:main"),i=e.currentUser.get("username"),n=e.container.lookup("controller:topic"),r=!!n&&n.get("model");return s.findFiltered("topicList",{filter:"topics/private-messages/"+i}).then(function(e){var s=e.topics.filter(function(e){return"user_to_user"===e.subtype&&e.get("last_read_post_number")<e.get("highest_post_number")&&-1===t.indexOf(e.id)&&(!r||!r.get("id")===e.id)}),i=0;return s.forEach(function(e){
i+=e.get("highest_post_number")-e.get("last_read_post_number")}),i})};e.getCurrentUserMessages=s,e.getCurrentUserMessageCount=i}),define("discourse/plugins/discourse-quick-messages/discourse/lib/docked-composer",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=function(e){var t=[];return e.forEach(function(e){var s=e.user?e.user.username:e.username;t.push(s)}),t},s=function(e){var t="",s=e.length;return e.forEach(function(e,i){t+=e,i<s-1&&(t+=i===s-2?" & ":", ")}),t},i=function(){var e=window.innerHeight-270,t=window.innerHeight>window.innerWidth,s=(t?window.screen.height:window.screen.width)-window.innerHeight>40;return t?(568===window.screen.height&&(e=270),667===window.screen.height&&(e=s?295:325),736===window.screen.height&&(e=s?353:383),812===window.screen.height&&(e=s?340:370),window.innerHeight>920&&(e-=45)):window.innerHeight>665&&(e-=128),Math.max(e,270)};e.getUsernames=t,e.formatUsernames=s,e.calcHeightWithKeyboard=i}),define("discourse/plugins/discourse-quick-messages/discourse/widgets/message-menu",["exports","discourse/widgets/widget","virtual-dom"],function(e,t,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=(0,t.createWidget)("messages-menu",{tagName:"div.messages-menu",panelContents:function(){return[this.attach("message-list"),(0,s.h)("div.menu-footer",[(0,s.h)("hr"),(0,s.h)("ul.menu-links",[(0,s.h)("li.all-messages",this.attach("link",{label:"show_more",action:"goToMessages"})),(0,s.h)("li.new-message",this.attach("link",{icon:"envelope",label:"user.new_private_message",action:"addToDocked"}))])])]},html:function(){var e=this;return this.attach("menu-panel",{contents:function(){return e.panelContents()}})},clickOutsideMobile:function(e){var t=this,s=$(document.elementFromPoint(e.clientX,e.clientY));if(s.parents(".panel").length&&!s.hasClass("header-cloak"))this.sendWidgetAction("toggleMessages");else{var i=$(window),n=parseInt(i.width(),10),r=$(".menu-panel");r.addClass("animate");var o=this.site.mobileView?"left":"right";r.css(o,-n);var a=$(".header-cloak");a.addClass("animate"),a.css("opacity",0),Ember.run.later(function(){return t.sendWidgetAction("toggleMessages")},200)}},clickOutside:function(e){this.site.mobileView?this.clickOutsideMobile(e):this.sendWidgetAction("toggleMessages")}})}),define("discourse/plugins/discourse-quick-messages/discourse/widgets/message-list",["exports","discourse/widgets/widget","../lib/user-messages","virtual-dom","discourse/widgets/raw-html","discourse/lib/text"],function(e,t,s,i,n,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=(0,t.createWidget)("message-list",{tagName:"div.message-list",buildKey:function(){return"message-list"},defaultState:function(){return{messages:null,loading:!1}},messagesChanged:function(){this.refreshMessages(this.state)},refreshMessages:function(e){var t=this;this.loading||(e.loading=!0,(0,s.getCurrentUserMessages)(this).then(function(s){if(s.length){var i=s.slice(0,7);i.forEach(function(t){if(t.last_read_post_number<t.highest_post_number&&(t.set("unread",!0),t.set("newCount",t.highest_post_number-t.last_read_post_number)),t.message_excerpt){var s=new n.default({html:"<div class='message-excerpt'>"+(0,r.emojiUnescape)(t.message_excerpt)+"</div>"});t.set("excerpt",s)}e.messages=i})}else e.messages="empty";e.loading=!1,t.scheduleRerender()}))},html:function(e,t){var s=this;t.messages||this.refreshMessages(t);var n=[];if(t.loading)n.push((0,i.h)("div.spinner-container",(0,i.h)("div.spinner")));else if("empty"!==t.messages){var r=t.messages.map(function(e){return s.attach("message-item",e)});n.push((0,i.h)("ul",[r]))}else n.push((0,i.h)("div.no-messages",I18n.t("user.no_quick_messages")));return n}})}),define("discourse/plugins/discourse-quick-messages/discourse/widgets/docked-small-action",["exports","discourse/widgets/widget","discourse/widgets/raw-html","discourse-common/lib/icon-library","discourse/lib/formatter","discourse/lib/url","virtual-dom"],function(e,t,s,i,n,r,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e,t,s){var i=new Date(t),o=(0,n.autoUpdatingRelativeAge)(i,{format:"tiny",addAgo:!0}),a="";return s&&(a="invited_group"===e||"removed_group"===e?'<a class="mention-group" href="/groups/'+s+'">@'+s+"</a>":'<a class="mention" href="'+(0,r.userPath)(s)+'">@'+s+"</a>"),I18n.t("action_codes."+e,{who:a,when:o}).htmlSafe()},c={"closed.enabled":"lock","closed.disabled":"unlock-alt","autoclosed.enabled":"lock","autoclosed.disabled":"unlock-alt","archived.enabled":"folder","archived.disabled":"folder-open","pinned.enabled":"thumb-tack","pinned.disabled":"thumb-tack unpinned","pinned_globally.enabled":"thumb-tack","pinned_globally.disabled":"thumb-tack unpinned","banner.enabled":"thumb-tack","banner.disabled":"thumb-tack unpinned","visible.enabled":"eye","visible.disabled":"eye-slash",split_topic:"sign-out",invited_user:"plus-circle",invited_group:"plus-circle",user_left:"minus-circle",removed_user:"minus-circle",removed_group:"minus-circle",public_topic:"comment",private_topic:"envelope"};e.default=(0,t.createWidget)("docked-small-action",{tagName:"div.docked-small-action",html:function(e){var t=[];t.push((0,o.h)("div.icon",(0,i.iconNode)(c[e.action_code]||"exclamation"))),t.push((0,o.h)("span",(0,o.h)("a.mention",{href:(0,r.userPath)(e.username)},"@"+e.username)));var n=a(e.action_code,e.created_at,e.action_code_who);return t.push(new s.default({html:"<span>"+n+"</span>"})),e.cooked&&t.push(new s.default({html:"<div class='custom-message'>"+e.cooked+"</div>"})),t}})}),define("discourse/plugins/discourse-quick-messages/discourse/widgets/message-item",["discourse/widgets/widget","virtual-dom","discourse/widgets/post"],function(e,t,s){"use strict";(0,e.createWidget)("message-item",{tagName:"li.message-item",buildClasses:function(e){var t=[];return e.get("unread")&&t.push("unread"),t},html:function(e){var i=e.participants.map(function(e){return(0,s.avatarImg)("small",{template:e.user.avatar_template,username:e.user.username})}),n=[(0,t.h)("ul",(0,t.h)("li",i)),e.get("excerpt")];return e.get("unread")&&n.push((0,t.h)("div",{className:"new-count"},e.get("newCount")+" "+I18n.t("new_item"))),(0,t.h)("a",(0,t.h)("div.item-contents",n))},click:function(){this.attrs.set("unread",!1);var e=this.attrs.id;this.sendWidgetAction("addToDocked",e)}})}),define("discourse/plugins/discourse-quick-messages/discourse/widgets/docked-post",["exports","discourse/widgets/widget","discourse/widgets/post-cooked","discourse/widgets/decorator-helper","discourse/lib/formatter"],function(e,t,s,i,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),l=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),c(t,[{key:"init",value:function(){var e=$("<div class='cooked'>"+this.attrs.cooked+"</div>");return this._insertQuoteControls(e),this._showLinkCounts(e),this._fixImageSizes(e),this._applySearchHighlight(e),e[0]}},{key:"update",value:function(e){return this.init()}}]),t}(s.default);e.default=(0,t.createWidget)("docked-post",{buildAttributes:function(e){return{title:(0,n.longDate)(e.post.created_at)}},html:function(e){var t=e.post;return new l(t,new i.default(this))}})}),define("discourse/plugins/discourse-quick-messages/discourse/pre-initializers/quick-messages-pre-initializer",["exports","ember-addons/ember-computed-decorators","discourse/lib/plugin-api"],function(e,t,s){"use strict";function i(e,t,s,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=s.slice().reverse().reduce(function(s,i){return i(e,t,s)||s},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"quick-messages-pre-initializer",initialize:function(e){var n=e.lookup("current-user:main");n&&n.show_quick_messages&&(0,s.withPluginApi)("0.8.12",function(e){var s,n,r,o;e.modifyClass("controller:application",(s=(0,t.on)("didInsertElement"),n=(0,t.on)("willDestroyElement"),r=(0,t.default)(),o={docked:Ember.A(),_setupQuickMessages:function(){$(window).on("resize",Ember.run.bind(this,this.maxIndex))},_teardownQuickMessages:function(){$(window).off("resize",Ember.run.bind(this,this.maxIndex))},maxIndex:function(){return this.site.mobileView?1:Math.floor(($(window).width()-390)/340)},actions:{addToDocked:function(e){e=e||"new";var t=this.get("docked");if(!t.includes(e)){var s=this.get("maxIndex");t.length>=s?t.replace(0,1,e):t.pushObject(e)}},removeDocked:function(e){this.get("docked").removeAt(e)},updateId:function(e,t){this.get("docked").replace(e,1,t)}}},i(o,"_setupQuickMessages",[s],Object.getOwnPropertyDescriptor(o,"_setupQuickMessages"),o),i(o,"_teardownQuickMessages",[n],Object.getOwnPropertyDescriptor(o,"_teardownQuickMessages"),o),i(o,"maxIndex",[r],Object.getOwnPropertyDescriptor(o,"maxIndex"),o),o))})}}}),Ember.TEMPLATES["javascripts/components/star-rating"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["star"],"statements":[[4,"each",[[23,["stars"]]],null,{"statements":[[0,"  "],[1,[27,"rating-star",null,[["value","rating","enabled"],[[22,1,[]],[23,["rating"]],[23,["enabled"]]]]],false],[7,"i"],[9],[10],[0,"\\n"]],"parameters":[1]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/star-rating"}}),Ember.TEMPLATES["javascripts/components/topic-tip"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[27,"d-button",null,[["class","action","label","icon"],["btn btn-small","toggleDetails",[23,["label"]],"info"]]],false],[0,"\\n"],[4,"if",[[23,["showDetails"]]],null,{"statements":[[0,"  "],[7,"div"],[11,"class","tip-details"],[9],[0,"\\n    "],[1,[27,"i18n",[[23,["details"]]],null],true],[0,"\\n  "],[10],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/topic-tip"}}),Ember.TEMPLATES["javascripts/components/select-rating"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[23,["showIncludeRating"]]],null,{"statements":[[0,"  "],[1,[27,"input",null,[["type","checked"],["checkbox",[23,["includeRating"]]]]],false],[0,"\\n"]],"parameters":[]},null],[7,"span"],[9],[1,[27,"i18n",["composer.your_rating"],null],false],[10],[0,"\\n"],[4,"if",[[23,["includeRating"]]],null,{"statements":[[0,"  "],[1,[27,"star-rating",null,[["enabled","rating"],[[23,["includeRating"]],[23,["rating"]]]]],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/select-rating"}}),Ember.TEMPLATES["javascripts/components/composer-add-rating"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[23,["showRating"]]],null,{"statements":[[0,"  "],[1,[27,"select-rating",null,[["rating","includeRating"],[[23,["model","rating"]],[23,["model","includeRating"]]]]],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/composer-add-rating"}}),Ember.TEMPLATES["javascripts/discourse/connectors/category-custom-settings/set-ratings"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"section"],[11,"class","field"],[9],[0,"\\n  "],[7,"label"],[9],[0,"\\n    "],[1,[27,"input",null,[["type","checked"],["checkbox",[23,["category","custom_fields","rating_enabled"]]]]],false],[0,"\\n    "],[1,[27,"i18n",["category.enable_rating"],null],false],[0,"\\n  "],[10],[0,"\\n"],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/connectors/category-custom-settings/set-ratings"}}),define("discourse/plugins/discourse-ratings/discourse/connectors/category-custom-settings/set-ratings",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={setupComponent:function(e){var t=e.category;t.custom_fields||(t.custom_fields={})}}}),Discourse.RAW_TEMPLATES["javascripts/discourse/connectors/topic-list-after-title/topic-list-rating"]=requirejs("discourse-common/lib/raw-handlebars").template({1:function(e,t,s,i,n){var r;return null!=(r=s.if.call(null!=t?t:e.nullContext||{},"context.topic.show_average",{name:"if",hash:{},hashTypes:{},hashContexts:{},fn:e.program(2,n,0),inverse:e.noop,types:["PathExpression"],contexts:[t],data:n}))?r:""},2:function(e,t,s,i,n){var r;return null!=(r=s.if.call(null!=t?t:e.nullContext||{},"context.topic.has_ratings",{name:"if",hash:{},hashTypes:{},hashContexts:{},fn:e.program(3,n,0),inverse:e.noop,types:["PathExpression"],contexts:[t],data:n}))?r:""},3:function(e,t,s,i,n){var r;return'      <div class="topic-rating">\n        <a href=\''+e.escapeExpression(s.get.call(null!=t?t:e.nullContext||{},"context.topic.url",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:n}))+"'>\n          "+e.escapeExpression((s["star-rating-raw"]||t&&t["star-rating-raw"]||s.helperMissing).call(null!=t?t:e.nullContext||{},"context.topic.average_rating",{name:"star-rating-raw",hash:{clickable:"true"},hashTypes:{clickable:"StringLiteral"},hashContexts:{clickable:t},types:["PathExpression"],contexts:[t],data:n}))+"\n"+(null!=(r=s.if.call(null!=t?t:e.nullContext||{},"context.siteSettings.rating_show_exact_average",{name:"if",hash:{},hashTypes:{},hashContexts:{},fn:e.program(4,n,0),inverse:e.noop,types:["PathExpression"],contexts:[t],data:n}))?r:"")+(null!=(r=s.if.call(null!=t?t:e.nullContext||{},"context.siteSettings.rating_show_count",{name:"if",hash:{},hashTypes:{},hashContexts:{},fn:e.program(6,n,0),inverse:e.noop,types:["PathExpression"],contexts:[t],data:n}))?r:"")+"        </a>\n      </div>\n"},4:function(e,t,s,i,n){return'            <span class="exact-rating">\n              ('+e.escapeExpression(s.get.call(null!=t?t:e.nullContext||{},"context.topic.average_rating",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:n}))+")\n            </span>\n"},6:function(e,t,s,i,n){return'            <span class="rating-count">\n              '+e.escapeExpression(s.get.call(null!=t?t:e.nullContext||{},"context.topic.rating_count",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:n}))+"\n              "+e.escapeExpression((s.i18n||t&&t.i18n||s.helperMissing).call(null!=t?t:e.nullContext||{},"topic.x_rating_count",{name:"i18n",hash:{count:"context.topic.rating_count"},hashTypes:{count:"PathExpression"},hashContexts:{count:t},types:["StringLiteral"],contexts:[t],data:n}))+"\n            </span>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,s,i,n){var r;return null!=(r=s.if.call(null!=t?t:e.nullContext||{},"context.siteSettings.rating_topic_list_average_enabled",{name:"if",hash:{},hashTypes:{},hashContexts:{},fn:e.program(1,n,0),inverse:e.noop,types:["PathExpression"],contexts:[t],data:n}))?r:""},useData:!0}),Ember.TEMPLATES["javascripts/discourse/connectors/topic-title/topic-rating"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[23,["siteSettings","rating_topic_average_enabled"]]],null,{"statements":[[0,"  "],[7,"div"],[11,"class","average-rating"],[9],[0,"\\n"],[4,"if",[[23,["model","rating_enabled"]]],null,{"statements":[[4,"if",[[23,["model","has_ratings"]]],null,{"statements":[[0,"        "],[1,[27,"star-rating-raw",[[23,["model","average_rating"]]],null],false],[0,"\\n"],[4,"if",[[23,["siteSettings","rating_show_exact_average"]]],null,{"statements":[[0,"          "],[7,"span"],[11,"class","exact-rating"],[9],[0,"\\n            ("],[1,[23,["model","average_rating"]],false],[0,")\\n          "],[10],[0,"\\n"]],"parameters":[]},null],[4,"if",[[23,["siteSettings","rating_show_count"]]],null,{"statements":[[0,"          "],[7,"span"],[11,"class","rating-count"],[9],[0,"\\n            "],[1,[23,["model","rating_count"]],false],[0,"\\n            "],[1,[27,"i18n",["topic.x_rating_count"],[["count"],[[23,["model","rating_count"]]]]],false],[0,"\\n          "],[10],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},{"statements":[[0,"        "],[1,[27,"i18n",["topic.no_ratings"],null],false],[0,"\\n"]],"parameters":[]}]],"parameters":[]},{"statements":[[4,"if",[[23,["model","average_rating"]]],null,{"statements":[[4,"if",[[23,["currentUser","admin"]]],null,{"statements":[[0,"          "],[7,"span"],[11,"class","exact-rating"],[9],[1,[27,"i18n",["topic.hidden_ratings"],null],false],[10],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},null]],"parameters":[]}],[0,"  "],[10],[0,"\\n"]],"parameters":[]},null],[4,"if",[[23,["model","showRatingTip"]]],null,{"statements":[[0,"  "],[1,[27,"topic-tip",null,[["label","details"],["topic.tip.ratings.title","topic.tip.ratings.details"]]],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/connectors/topic-title/topic-rating"}}),Ember.TEMPLATES["javascripts/discourse/connectors/composer-fields/composer-controls-rating"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[23,["model","showRating"]]],null,{"statements":[[0,"  "],[1,[27,"select-rating",null,[["rating","includeRating"],[[23,["model","rating"]],[23,["model","includeRating"]]]]],false],[0,"\\n"]],"parameters":[]},null],[4,"if",[[23,["model","showRatingTargetId"]]],null,{"statements":[[0,"  "],[1,[27,"input",null,[["class","value","placeholder"],["rating-target-id",[23,["model","rating_target_id"]],[27,"i18n",["composer.rating_target_id"],null]]]],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/connectors/composer-fields/composer-controls-rating"}}),define("discourse/plugins/discourse-ratings/discourse/initializers/ratings-edits",["exports","discourse/models/composer","discourse/lib/plugin-api","ember-addons/ember-computed-decorators","../lib/rating-utilities"],function(e,t,s,i,n){"use strict";function r(e,t,s,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=s.slice().reverse().reduce(function(s,i){return i(e,t,s)||s},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"ratings-edits",initialize:function(){t.default.serializeOnCreate("rating"),t.default.serializeOnCreate("rating_target_id","rating_target_id"),t.default.serializeToTopic("rating_target_id","topic.rating_target_id"),(0,s.withPluginApi)("0.8.10",function(e){var s,o,a,c,l,u,d,p,m,g,f,h,b,v,_,w,y,k;e.includePostAttributes("rating"),e.decorateWidget("poster-name:after",function(e){var t=e.attrs.rating,s=e.getModel();if(s&&s.topic&&s.topic.rating_enabled&&t){var i=new Handlebars.SafeString((0,n.starRatingRaw)(t));return e.rawHtml(""+i)}}),e.modifyClass("model:composer",(s=(0,i.on)("init"),o=(0,i.observes)("post","ratingEnabled"),a=(0,i.default)("subtype","tags","categoryId"),c=(0,i.default)("ratingEnabled","hideRating","topic","post"),l=(0,i.default)("ratingEnabled"),u=(0,i.observes)("topic.rating_target_id"),d={includeRating:!1,includeRatingTargetId:!1,ratingTargetId:void 0,setRating:function(){var e=this.get("post"),t=this.get("editingPost"),s=this.get("creatingTopic"),i=this.get("ratingEnabled");t&&e&&e.rating&&this.setProperties({rating:e.rating,includeRating:!0}),i&&s&&this.set("includeRating",!0)},ratingEnabled:function(e,t,s){return(0,n.ratingEnabled)(e,t,s)},showRating:function(e,s,i,n){return!s&&(n&&n.get("firstPost")&&i.rating_enabled||!i?e:!!i.can_rate||i.rating_enabled&&n&&n.rating&&this.get("action")===t.default.EDIT)},showRatingTargetId:function(e){var t=this.user,s=Discourse.SiteSettings.rating_target_id_enabled;return e&&s&&t.admin},renderRatingTargetIdInput:function(){var e=this.get("topic.rating_target_id"),t=this.get("rating_target_id");e&&void 0===t&&(this.set("rating_target_id",e),this.set("showRatingTargetId",!1),this.set("showRatingTargetId",!0))}},r(d,"setRating",[s,o],Object.getOwnPropertyDescriptor(d,"setRating"),d),r(d,"ratingEnabled",[a],Object.getOwnPropertyDescriptor(d,"ratingEnabled"),d),r(d,"showRating",[c],Object.getOwnPropertyDescriptor(d,"showRating"),d),r(d,"showRatingTargetId",[l],Object.getOwnPropertyDescriptor(d,"showRatingTargetId"),d),r(d,"renderRatingTargetIdInput",[u],Object.getOwnPropertyDescriptor(d,"renderRatingTargetIdInput"),d),d)),e.modifyClass("controller:composer",(p=(0,i.observes)("model.composeState"),m={actions:{save:function(){var e=this,t=this.get("model.showRating"),s=this.get("model.includeRating"),i=this.get("model.rating");if(t&&s&&!i)return bootbox.alert(I18n.t("composer.select_rating"));var n=this.save();n&&Promise.resolve(n).then(function(){if(t&&s&&i){e.get("topicController").toggleCanRate()}})}},saveRatingAfterEditing:function(){if(this.get("model.showRating")&&this.get("model.action")===t.default.EDIT&&this.get("model.composeState")===t.default.SAVING){var e=this.get("model.rating");if(e){var s=this.get("model.post");if(this.get("model.includeRating"))(0,n.editRating)(s.id,e);else{(0,n.removeRating)(s.id);this.get("topicController").toggleCanRate()}}}}},r(m,"saveRatingAfterEditing",[p],Object.getOwnPropertyDescriptor(m,"saveRatingAfterEditing"),m),m)),e.modifyClass("component:composer-body",(g=(0,i.observes)("composer.showRating"),f={resizeIfShowRating:function(){this.get("composer.composeState")===t.default.OPEN&&this.resize()}},r(f,"resizeIfShowRating",[g],(h=Object.getOwnPropertyDescriptor(f,"resizeIfShowRating"),h=h?h.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return h}}),f),f)),e.modifyClass("model:topic",(b=(0,i.default)("subtype","tags","category_id"),v=(0,i.default)("ratingEnabled"),_={ratingEnabled:function(e,t,s){return(0,n.ratingEnabled)(e,t,s)},showRatingTip:function(e){return e&&this.siteSettings.rating_show_topic_tip}},r(_,"ratingEnabled",[b],Object.getOwnPropertyDescriptor(_,"ratingEnabled"),_),r(_,"showRatingTip",[v],Object.getOwnPropertyDescriptor(_,"showRatingTip"),_),_)),e.modifyClass("controller:topic",(w=(0,i.observes)("unsubscribed","model.postStream"),y=(0,i.observes)("editingTopic"),k={refreshAfterTopicEdit:!1,unsubscribed:!1,unsubscribe:function(){if(this.get("content.id")){var e=this.messageBus;e&&(e.unsubscribe("/topic/*"),this.set("unsubscribed",!0))}},subscribeToRatingUpdates:function(){var e=this,t=this.get("unsubscribed"),s=this.get("model"),i=this.get("subscribedTo");if(t){if(this.set("unsubscribed",!1),s&&s.id===i)return this.set("subscribedTo",null);if(this.set("subscribedTo",null),s&&s.get("postStream")&&s.rating_enabled){var n=function(t){return e.appEvents.trigger("post-stream:refresh",t)};this.messageBus.subscribe("/topic/"+s.id,function(e){"revised"===e.type&&(void 0!==e.average_rating&&s.set("average_rating",e.average_rating),void 0!==e.rating_count&&s.set("rating_count",e.rating_count),void 0!==e.post_id&&s.get("postStream").triggerChangedPost(e.post_id,e.updated_at).then(function(){return n({id:e.post_id})}))}),this.set("subscribedTo",s.id)}}},refreshPostRatingVisibility:function(){!this.get("editingTopic")&&this.get("refreshAfterTopicEdit")&&(this.get("model.postStream").refresh(),this.set("refreshAfterTopicEdit",!1))},toggleCanRate:function(){this.get("model")&&this.toggleProperty("model.can_rate")}},r(k,"subscribeToRatingUpdates",[w],Object.getOwnPropertyDescriptor(k,"subscribeToRatingUpdates"),k),r(k,"refreshPostRatingVisibility",[y],Object.getOwnPropertyDescriptor(k,"refreshPostRatingVisibility"),k),k))})}}}),define("discourse/plugins/discourse-ratings/discourse/components/topic-tip",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=Ember.Component.extend({classNames:"topic-tip",didInsertElement:function(){Ember.$(document).on("click",Ember.run.bind(this,this.documentClick))},willDestroyElement:function(){Ember.$(document).off("click",Ember.run.bind(this,this.documentClick))},documentClick:function(e){var t=this.$();$(e.target).closest(t).length<1&&"destroying"!==this._state&&this.set("showDetails",!1)},actions:{toggleDetails:function(){this.toggleProperty("showDetails")}}})}),define("discourse/plugins/discourse-ratings/discourse/components/star-rating",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=Ember.Component.extend({tagName:"span",classNames:"star-rating",stars:[1,2,3,4,5],enabled:!1})}),define("discourse/plugins/discourse-ratings/discourse/components/rating-star",["exports","ember-addons/ember-computed-decorators"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,i;e.default=Ember.Component.extend((s=(0,t.default)("rating"),i={tagName:"input",disabled:Ember.computed.not("enabled"),attributeBindings:["value","checked:checked","disabled:disabled"],willInsertElement:function(){this.$().prop("type","radio")},click:function(){this.set("rating",this.$().val())},checked:function(e){return this.get("value")<=e}},function(e,t,s,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=s.slice().reverse().reduce(function(s,i){return i(e,t,s)||s},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}(i,"checked",[s],Object.getOwnPropertyDescriptor(i,"checked"),i),i))}),define("discourse/plugins/discourse-ratings/discourse/components/composer-add-rating",["exports","ember-addons/ember-computed-decorators"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,i;e.default=Ember.Component.extend((s=(0,t.default)("model.subtype","model.showRating"),i={showRating:function(e,t){return"rating"===e&&t}},function(e,t,s,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=s.slice().reverse().reduce(function(s,i){return i(e,t,s)||s},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}(i,"showRating",[s],Object.getOwnPropertyDescriptor(i,"showRating"),i),i))}),define("discourse/plugins/discourse-ratings/discourse/components/select-rating",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=Ember.Component.extend({tagName:"div",classNames:["rating-container"],showIncludeRating:!0})}),define("discourse/plugins/discourse-ratings/discourse/lib/rating-utilities",["exports","discourse/lib/ajax","discourse/lib/ajax-error"],function(e,t,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.starRatingRaw=e.editRating=e.removeRating=e.ratingEnabled=void 0;var i=function(e,t,s){var i=Discourse.Category.findById(s),n=i&&i.rating_enabled,r=t&&t.filter(function(e){return-1!==Discourse.SiteSettings.rating_tags.split("|").indexOf(e)}).length>0,o="rating"===e;return n||r||o},n=function(e){return(0,t.ajax)("/rating/remove",{type:"POST",data:{post_id:e}}).then(function(e,t){t&&(0,s.popupAjaxError)(t)})},r=function(e,i){return(0,t.ajax)("/rating/rate",{type:"POST",data:{post_id:e,rating:i}}).then(function(e,t){t&&(0,s.popupAjaxError)(t)})},o=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="",i=0;i<5;i++){var n=i+1,r=n<=e?"checked":"",o=t.enabled?"":" disabled",a="";t.clickable?a+='<span class="'+r+o+'"></span>':a+='<input class="'+o+'"type="radio" value="'+n+'" '+r+o+">",a+="<i></i>",s=s.concat(a)}return'<span class="star-rating">'+s+"</span>"};e.ratingEnabled=i,e.removeRating=n,e.editRating=r,e.starRatingRaw=o}),define("discourse/plugins/discourse-ratings/discourse/widgets/star-rating",["exports","discourse/widgets/widget","virtual-dom"],function(e,t,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=(0,t.createWidget)("star-rating",{tagName:"span.star-rating",html:function(e){var t=this,i=[1,2,3,4,5],n=[];return i.forEach(function(i){var r=i<=e.rating;n.push(t.attach("rating-star",{value:i,checked:r,disabled:e.disabled}),(0,s.h)("i"))}),n}})}),define("discourse/plugins/discourse-ratings/discourse/widgets/rating-star",["exports","discourse/widgets/widget"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=(0,t.createWidget)("rating-star",{tagName:"input",buildAttributes:function(e){var t={type:"radio",value:e.value};return e.checked&&(t.checked=!0),e.disabled&&(t.disabled=!0),t},html:function(){}})}),define("discourse/plugins/discourse-ratings/discourse/widgets/linked-rating",["exports","discourse/widgets/widget","discourse/lib/url"],function(e,t,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=(0,t.createWidget)("linked-rating",{tagName:"span.linked-rating",html:function(e){return this.attach("star-rating",{rating:e.rating,disabled:e.disabled})},click:function(){s.default.routeTo(this.attrs.href)}})}),define("discourse/plugins/discourse-ratings/discourse/helpers/rating-helpers",["discourse-common/lib/helpers","../lib/rating-utilities"],function(e,t){"use strict";(0,e.registerUnbound)("star-rating-raw",function(e,s){return new Handlebars.SafeString((0,t.starRatingRaw)(e,s))}),(0,e.registerUnbound)("average-rating",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=""+e;return Discourse.SiteSettings.rating_show_count&&t.count&&(s+=" – "+t.count+" "+I18n.t("topic.x_rating_count",{count:t.count})),new Handlebars.SafeString(s)})}),Ember.TEMPLATES["javascripts/connectors/discovery-list-container-top/online_users_widget"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[21,"whos-online"],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/discovery-list-container-top/online_users_widget"}}),Ember.TEMPLATES["javascripts/components/whos-online-avatar"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[27,"avatar",[[23,["user"]]],[["avatarTemplatePath","title","imageSize"],["avatar_template",[23,["user","username"]],"small"]]],false]],"hasEval":false}',meta:{moduleName:"javascripts/components/whos-online-avatar"}}),Ember.TEMPLATES["javascripts/components/whos-online"]=Ember.HTMLBars.template({id:null,
block:'{"symbols":["user"],"statements":[[4,"if",[[23,["showWhosOnline"]]],null,{"statements":[[0,"    "],[7,"div"],[11,"id","whos-online"],[12,"class",[28,[[27,"if",[[23,["isLong"]],"collapsed"],null]]]],[9],[0,"\\n        "],[7,"span"],[12,"title",[28,[[27,"i18n",["whos_online.tooltip"],null]]]],[9],[0,"\\n"],[4,"if",[[23,["isUsers"]]],null,{"statements":[[0,"        \\t\\t"],[1,[27,"i18n",["whos_online.title"],[["count"],[[23,["online","users","length"]]]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"        \\t\\t"],[1,[27,"i18n",["whos_online.no_users"],null],false],[0,"\\n"]],"parameters":[]}],[0,"        "],[10],[0,"\\n"],[4,"if",[[23,["isUsers"]]],null,{"statements":[[4,"each",[[23,["users"]]],null,{"statements":[[0,"        \\t\\t"],[1,[27,"whos-online-avatar",null,[["user"],[[22,1,[]]]]],false],[0,"\\n"]],"parameters":[1]},null]],"parameters":[]},null],[0,"    "],[10],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/whos-online"}}),define("discourse/plugins/discourse-whos-online/discourse/services/online-service",["exports","ember","discourse/lib/ajax","discourse/models/user"],function(e,t,s,i){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,s=Array(e.length);t<e.length;t++)s[t]=e[t];return s}return Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=t.default.Service.extend({after:"message-bus",messageBus:window.MessageBus,users:[],appEvents:Discourse.__container__.lookup("app-events:main"),siteSettings:Discourse.__container__.lookup("site-settings:main"),_lastMessageId:null,isUserOnline:function(e){var t=function(e){return e.id===this};return void 0!==this.get("users").find(t,e)},messageProcessor:function(){var e=this;return function(t,r,o){var a=e.get("users");if(o!==e.get("_lastMessageId")+1)return e.messageBus.unsubscribe("/whos-online",this.func),void(0,s.ajax)("/whosonline/get.json",{method:"GET"}).then(function(t){var s=a.map(function(e){return e.get("id")});e.set("users",t.users.map(function(e){return i.default.create(e)}));var r=e.get("users").map(function(e){return e.get("id")});e.set("_lastMessageId",t.messagebus_id),e.messageBus.subscribe("/whos-online",e.messageProcessor(),t.messagebus_id);var o=[].concat(n(s),n(r));e.appEvents.trigger("whosonline:changed",o)},function(e){console.log(e)});switch(e.set("_lastMessageId",o),t.message_type){case"going_online":var c=i.default.create(t.user);a.pushObject(c),e.appEvents.trigger("whosonline:changed",[c.get("id")]);break;case"going_offline":var l=function(e){return e.get("id")===this};t.users.forEach(function(e){var t=a.find(l,e);void 0!==t&&a.removeObject(t)}),e.appEvents.trigger("whosonline:changed",t.users);break;default:console.error("Unknown message type sent to /whos-online")}}},init:function(){var e=Discourse.Site.currentProp("users_online");e&&(this.set("users",e.users.map(function(e){return i.default.create(e)})),this.set("_lastMessageId",e.messagebus_id),this.appEvents.trigger("whosonline:changed",e.users.map(function(e){return e.id})),this.messageBus.subscribe("/whos-online",this.messageProcessor(),e.messagebus_id))},shouldDisplay:function(){if(!this.siteSettings.whos_online_enabled)return!1;if(this.siteSettings.whos_online_display_public)return!0;var e=Discourse.User.current();return null!==e&&e.trust_level>=this.siteSettings.whos_online_display_min_trust_level}.property()})}),define("discourse/plugins/discourse-whos-online/discourse/initializers/start-whos-online",["exports","discourse/lib/plugin-api"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=Ember.inject;e.default={name:"start-whos-online",initialize:function(e){var i=e.lookup("service:online-service"),n=e.lookup("site-settings:main");if(i.get("shouldDisplay")){var r=n.whos_online_avatar_indicator;"none"!==r&&($("html").addClass("whos-online-"+r),(0,t.withPluginApi)("0.2",function(e){e.modifyClass("component:user-card-contents",{onlineService:s.service("online-service"),classNameBindings:["isOnline:user-online"],isOnline:function(){return!!this.get("user")&&this.get("onlineService").isUserOnline(this.get("user").id)}.property("onlineService.users.@each","user")}),e.modifyClass("route:user",{onlineService:s.service("online-service"),afterModel:function(){return this.updateBodyClass(),this._super()},updateBodyClass:function(){var e=this.modelFor("user").id;this.get("onlineService").isUserOnline(e)?Ember.$("body").addClass("user-page-online"):Ember.$("body").removeClass("user-page-online")}.observes("onlineService.users.@each"),deactivate:function(){this._super(),Ember.$("body").removeClass("user-page-online")}}),n.whos_online_avatar_indicator_topic_lists&&(e.modifyClass("component:topic-list-item",{onlineService:s.service("online-service"),classNameBindings:["isOnline:last-poster-online"],isOnline:function(){return this.get("onlineService").isUserOnline(this.get("topic.lastPoster.id"))}.property("onlineService.users.@each","user")}),e.modifyClass("component:latest-topic-list-item",{onlineService:s.service("online-service"),classNameBindings:["isOnline:last-poster-online"],isOnline:function(){return this.get("onlineService").isUserOnline(this.get("topic.lastPoster.id"))}.property("onlineService.users.@each","user")})),e.modifyClass("component:scrolling-post-stream",{didInsertElement:function(){var e=this;this._super(),this.appEvents.on("whosonline:changed",function(t){t.forEach(function(t){e.get("attrs").posts.value.posts.filter(function(e){return e.user_id===t}).map(function(e){return e.id}).forEach(function(s){e.dirtyKeys.keyDirty("post-"+s),e.dirtyKeys.keyDirty("post-"+s+"-avatar-"+t,{onRefresh:"updateOnline"})})}),e.queueRerender()})},willDestroyElement:function(){this.appEvents.off("whosonline:changed")}}),e.reopenWidget("post-avatar",{buildKey:function(e){return"post-"+e.id+"-avatar-"+e.user_id},defaultState:function(e){return{online:i.isUserOnline(e.user_id)}},updateOnline:function(){this.state.online=i.isUserOnline(this.attrs.user_id)},buildClasses:function(e,t){return t.online?"user-online":[]}})}))}}}}),define("discourse/plugins/discourse-whos-online/discourse/components/whos-online",["exports","ember"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=t.default.inject;e.default=t.default.Component.extend({showWhosOnline:function(){return!(this.get("online").users.length<this.siteSettings.whos_online_minimum_display&&this.siteSettings.whos_online_hide_below_minimum_display)&&this.get("online").get("shouldDisplay")}.property(),online:s.service("online-service"),users:function(){return this.get("online").users.slice(0,this.siteSettings.whos_online_maximum_display)}.property("online.users.@each"),isLong:function(){return this.get("online").users.length>=this.siteSettings.whos_online_collapse_threshold}.property("online.users.length"),isUsers:function(){return this.get("online").users.length>=this.siteSettings.whos_online_minimum_display}.property("online.users.length")})}),define("discourse/plugins/discourse-whos-online/discourse/components/whos-online-avatar",["exports","ember"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=t.default.Component.extend({tagName:"a",attributeBindings:["user.username:data-user-card","user.path:href"]})});
//# sourceMappingURL=/assets/plugin-third-party-fc26f2b60ab71a7004541b02df8fcd5581f50b3cfcc6b07b4a42e061f6caa7e7.js.map